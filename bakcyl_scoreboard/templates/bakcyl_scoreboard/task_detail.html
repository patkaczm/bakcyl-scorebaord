{% extends "task_detail_base.html" %}

{% load static %}
{% load crispy_forms_tags %}

{% block content_rhs %}
    <div class="shadow p-3 mb-5 bg-white rounded">
        {% if user.is_authenticated %}
            <h5>Your solution for task: <a href={{task.link}}>{{task.name}}</a></h5>
            
            {% if solution and not solution.isFinal %}
                <pre><code data-language="c">{{solution.code}}</code></pre>
                
                <form method="POST" class="form-group">
                        {% csrf_token %}
                        {{form|crispy}}
                        <button type="submit" name="submit" class="btn btn-success">Submit</button>
                        <button type="submit" name="final" class="btn btn-danger">Submit Final</button>
                </form>
            
            {% elif solution %}
            
                <pre><code data-language="c">{{solution.code}}</code></pre>
                {% if solution.score.isScored %}
                    <pre><code data-language="c">{{solution.score.comment}}</code></pre>
                    Score: {{solution.score.mark}}/{{task.max_score}}
                    <br>Tutor: {{solution.score.tutor}}
                {% endif %}
            
            {% else %}
                <form method="POST" class="form-group">
                        {% csrf_token %}
                        {{form|crispy}}
                        <button type="submit" name="submit" class="btn btn-success">Submit</button>
                        <button type="submit" name="final" class="btn btn-danger">Submit Final</button>
                </form>
            {% endif %}

        {% else %}
            Login <a href="/login">here.</a>
        {% endif %}
    </div>

{% endblock %}

{% block content_lhs %}
<div id="accordion">
    {% if all.mandatory.notdone or all.mandatory.done %}
    <div class="card">
        <div class="card-header" id="headingOne">
            <h5 class="mb-0">
                <button class="btn btn-link nounderline" data-toggle="collapse" data-target="#mandarotyTasks" aria-expanded="true" aria-controls="mandarotyTasks">
                Mandatory Tasks
                </button>
            </h5>
        </div>
        <div id="mandarotyTasks" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body">
                <div class="list-group">
                        {% if all.mandatory.notdone %}
                            Imcompleted:
                            {% for task in all.mandatory.notdone %}                          
                                <a href="/task/{{task.id}}" class="list-group-item nounderline list-group-item-danger"> {{task.name}}</a>
                            {% endfor %}
                        {% endif %}
                        {% if all.mandatory.done %}
                            Completed:    
                            {% for task in all.mandatory.done %}                          
                                <a href="/task/{{task.id}}" class="list-group-item nounderline list-group-item-success"> {{task.name}}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% if all.obligatory.notdone or all.obligatory.done %}
    <div class="card">
        <div class="card-header" id="headingOne">
            <h5 class="mb-0">
                <button class="btn btn-link nounderline" data-toggle="collapse" data-target="#obligatoryTasks" aria-expanded="true" aria-controls="obligatoryTasks">
                Obligatory Tasks
                </button>
            </h5>
        </div>
        <div id="obligatoryTasks" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body">
                <div class="list-group">
                        {% if all.notdone %}
                            Imcompleted:
                            {% for task in all.obligatory.notdone %}                          
                                <a href="/task/{{task.id}}" class="list-group-item nounderline list-group-item-danger"> {{task.name}}</a>
                            {% endfor %}
                        {% endif %}
                        {% if all.done %}
                            Completed:    
                            {% for task in all.obligatory.done %}                          
                                <a href="/task/{{task.id}}" class="list-group-item nounderline list-group-item-success"> {{task.name}}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}